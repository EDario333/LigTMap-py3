# LigTMap-py3 Target Prediction Method for Small Molecules

Welcome to the LigTMap-py3 target and activity prediction for
small molecules. This method currently support prediction for 
17 target classes including 6000+ protein targets. This code includes the main prediction workflow and all data/models so it can be run offline in your working computer (there is a web server available for better visualization of the prediction result, for details see the [LigTMap project](https://github.com/ShirleyWISiu/LigTMap)).

## Software requirements:
LigTMap-py3 is being written on top of:
- [Python 3.10.2](https://www.python.org/downloads/release/python-3102/)
- [rdkit-pypi](https://pypi.org/project/rdkit-pypi/) 2022.3.1
- [Open Babel](http://openbabel.org/wiki/Main_Page) 3.1.1
- [MOPAC2016](http://www.openmopac.net/MOPAC2016.html)
- [ODDT](https://oddt.readthedocs.io/) 0.7
- [PSOVina](https://cbbio.online/software/psovina/index.html) 2.0, 
- MGLTools
- [Boost](https://www.boost.org/) 1.59.0
- [pdb-tools](http://www.bonvinlab.org/pdb-tools/) 2.4.3

## INSTALLATION

For convenience a shell bash script was prepared, available at [`setup`](https://github.com/EDario333/LigTMap-py3/blob/master/setup).

All the software project requirements were installed on Debian GNU/Linux 11 (bullseye), Linux kernel version 5.10.0-13-amd64.

Finally, but not least, is advised to create a [python virtual environment](https://docs.python.org/3/library/venv.html) in order to have your own *"Python binary  and its own independent set of installed Python packages in its site directories.*

## LigTMap-py3
Additionally to the two of the main files in [LigTMap](https://github.com/ShirleyWISiu/LigTMap), `ligtmap.py` (in this project renamed to [`ligtmap_py3.py`](https://github.com/EDario333/LigTMap-py3/blob/master/ligtmap_py3.py)) and [`predict`](https://github.com/EDario333/LigTMap-py3/blob/master/predict), these files were created:

1. [`pdb-download`](https://github.com/EDario333/LigTMap-py3/blob/master/pdb-download)). To download PDB structures for those ECFP2 Morgan fingerprints not able to read from the original source provided by [LigTMap](https://github.com/ShirleyWISiu/LigTMap) (see [lines 126 to 152 in `ligtmap_py3.py`](https://github.com/EDario333/LigTMap-py3/blob/master/ligtmap_py3.py#L126-L152)).
2. [`bests.py`](https://github.com/EDario333/LigTMap-py3/blob/master/bests.py). Reads the results generated by `predict` and `ligtmap_py3.py` and creates a CSV file (named `bests.csv`), next to the `IFP_result.csv` (generated in the corresponding `Output/Input_#`). The `bests.csv` file will contains the bests LigTMap scores defined by new environment variables introduced by LigTMap-py3 (read below).

### Changes

As stated before, LigTMap-py3 introduces, among others, these changes:

1. The [`predict`](https://github.com/EDario333/LigTMap-py3/blob/master/predict#L19-L29) bash shell script (and, consequently, to run target predictions) validates:

    a) Model persisted format (environment variable `PERSISTED_FMT`). Although not implemented yet, is something deliberately done to let you know about one of the todo works; scikit-learn Machine Learning (ML) was removed, when the new models are available, uncomment the right code lines and finish model persistence implementations.

    b) Minimal ligand similarity score (environment variable `MIN_LIG_SIM`). Used in [`bests.py`](https://github.com/EDario333/LigTMap-py3/blob/master/bests.py) to filter those results in the `IFP_result.csv` fulfilling this requirement.

    c) Minimal binding similarity score (environment variable `MIN_BIN_SIM`). Used in [`bests.py`](https://github.com/EDario333/LigTMap-py3/blob/master/bests.py) to filter those results in the `IFP_result.csv` fulfilling this requirement.

    d) Minimal LigTMap score (environment variable `MIN_LTM_SIM`). Used in [`bests.py`](https://github.com/EDario333/LigTMap-py3/blob/master/bests.py) to filter those results in the `IFP_result.csv` fulfilling this requirement.

## HOW TO RUN TARGET PREDICTION

1. Prepare your molecule(s) to be predicted in `input.smi`, e.g. our benchmark molecules for HIV. Make sure you don't leave any empty lines in the file:

```
c1ccccc1Oc(ccc2)c(c23)n(c(=O)[nH]3)CC
c1c(C)cc(C)cc1Oc(ccc2)c(c23)n(c(=O)[nH]3)CC
N#Cc(c1)cc(Cl)cc1Oc(ccc2)c(c23)n(c(=O)[nH]3)CC
N#Cc(c1)cc(Cl)cc1Oc(ccc2)c(c23)n(C)c(=O)[nH]3
```

2. Prepare the list of targets in `target.lst`. For a complete list of supported targets, refer to [$LIGTMAP/target.lst](https://github.com/siuwengin/LigTMap/blob/master/target.lst).
```
HIV
HCV
```

3. Make sure you had activated the python virtual env (if it was created it):

```
$ source bin/activate
```

4. Set the environment variables: `LIGTMAP`, `MGLTools`, `PERSISTED_FMT` (experimental, but mandatory), `MIN_LIG_SIM`, `MIN_BIN_SIM`, `MIN_LTM_SIM`; as guidance, you can see [lines 52 to 58 in `setup` bash shell script](https://github.com/EDario333/LigTMap-py3/blob/master/setup#L52-L58):

```
$ export LIGTMAP=$PWD
$ export MGLTools=$HOME/opt/mgltools_x86_64Linux2_1.5.7/
$ export PERSISTED_FMT=pickle
$ export MIN_LIG_SIM=0.5
$ export MIN_BIN_SIM=0.5
$ export MIN_LTM_SIM=0.5
```

5. Run the prediction:

```
$ ./predict
```

The run will generate two directories `Input` and `Output`.
Input stores each molecule `SMILES` in a separate file: 
>   input_00001, input_00002, ...

Output stores prediction results for each molecule separately
in directories. 

> In case you have a previous run, the Input and Output directories
will be backuped to `Input.xxx` and `Output.xxx`.

5. Examine prediction results

In the summary section, the target class for which target proteins 
have been identified for the query molecule is marked `Complete`,
Otherwise `Fail`.

For a molecule `Input_xxxxx`, the top-ranked targets sorted by 
the `LigTMapScore` can be found in `Output/Input_xxxxx/IFP_result.csv`; the bests scores (defined by `MIN_LIG_SIM`, `MIN_BIN_SIM` and `MIN_LTM_SIM`) can be found in `Output/Input_xxxxx/bests.csv`.

The files contain 8 columns of data of the identified targets:
1. PDB
2. Class
3. TargetName
4. LigandName
5. LigandSimilarityScore
6. BindingSimilarityScore
7. LigTMapScore
8. DockingScore

The binding mode (PDB) of the molecule at the target protein can be found in the corresponding directory
`Output/Input_xxxxx/TargetName/Complex`

## Contact
Developer:
Edgar Ramirez-de-Leon (ram.le.dario@gmail.com)
